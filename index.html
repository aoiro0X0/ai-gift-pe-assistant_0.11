<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎁 AI礼物Prompt助手</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .mode-selector {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .mode-option {
            position: relative;
        }
        
        .mode-option input[type="radio"] {
            display: none;
        }
        
        .mode-option label {
            display: block;
            padding: 15px 30px;
            border: 3px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            min-width: 200px;
        }
        
        .mode-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }
        
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .video-params {
            display: none;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .video-params.show {
            display: block;
        }
        
        .video-params h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .param-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .param-label {
            font-weight: bold;
            color: #666;
            font-size: 14px;
        }
        
        .param-value {
            font-size: 16px;
            color: #333;
            margin-top: 5px;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin: 20px 0;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* 加载动画样式 */
        .loading-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #667eea;
            font-size: 16px;
            font-weight: bold;
        }
        
        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-container {
            margin-top: 30px;
            display: none;
        }
        
        .result-container.show {
            display: block;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }
        
        .result-box h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .result-text {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: monospace;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .copy-btn:hover {
            background: #218838;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎁 AI礼物Prompt助手</h1>
        </div>
        
        <div class="form-container">
            <!-- 隐藏API配置 -->
            <div style="display: none;">
                <input type="hidden" id="apiKey" value="4bdc017d-23e8-4ea6-b57a-cb9f85bdf72f">
                <input type="hidden" id="apiBase" value="https://ark-cn-beijing.bytedance.net/api/v3">
            </div>
            
            <form id="promptForm">
                <!-- 模式选择 -->
                <div class="form-group">
                    <label>🎯 生成模式：</label>
                    <div class="mode-selector">
                        <div class="mode-option">
                            <input type="radio" id="image_mode" name="generation_mode" value="image" checked>
                            <label for="image_mode">📸 图片 Prompt 模式</label>
                        </div>
                        <div class="mode-option">
                            <input type="radio" id="video_mode" name="generation_mode" value="video">
                            <label for="video_mode">🎬 视频 Prompt 模式</label>
                        </div>
                    </div>
                </div>
                
                <!-- 礼物价位选择（必选） -->
                <div class="form-group">
                    <label for="gift_price_range">💎 礼物价位（钻）<span style="color: red;">*</span>：</label>
                    <select id="gift_price_range" name="gift_price_range" required>
                        <option value="">请选择价位范围</option>
                        <option value="[1,20)">[1,20) - 1-20钻</option>
                        <option value="[20,99)">[20,99) - 20-99钻</option>
                        <option value="[99,200)">[99,200) - 99-200钻</option>
                        <option value="[299,500)">[299,500) - 299-500钻</option>
                        <option value="[500,700)">[500,700) - 500-700钻</option>
                        <option value="[700,1k)">[700,1k) - 700-1千钻</option>
                        <option value="[1k,2k)">[1k,2k) - 1千-2千钻</option>
                        <option value="[2k,3k)">[2k,3k) - 2千-3千钻</option>
            
                    </select>
                </div>
                
                <!-- 礼物类别（参考信息显示） -->
                <div class="form-group" id="category_group">
                    <label>🎁 礼物类别（参考信息）：</label>
                    <div id="gift_category_display" style="padding: 10px; background-color: #f5f5f5; border-radius: 5px; color: #666; font-size: 14px;">
                        请先选择价位查看建议对应礼物类别
                    </div>
                </div>
                
                <!-- 灵感词输入（必选） -->
                <div class="form-group">
                    <label for="inspiration_words">💡 灵感词<span style="color: red;">*</span>：</label>
                    <textarea id="inspiration_words" name="inspiration_words" placeholder="请输入灵感词，如：风格、元素、构图、主题、情感氛围等" required></textarea>
                </div>
                
                <!-- 视频制作参数显示区域 -->
                <div class="video-params" id="video_params">
                    <h4>🎬 视频制作参数（根据价位自动映射）</h4>
                    <div class="param-grid">
                        <div class="param-item">
                            <div class="param-label">时长</div>
                            <div class="param-value" id="duration">-</div>
                        </div>
                        <div class="param-item">
                            <div class="param-label">屏占比</div>
                            <div class="param-value" id="aspect_ratio">-</div>
                        </div>
                        <div class="param-item">
                            <div class="param-label">镜头数</div>
                            <div class="param-value" id="shot_count">-</div>
                        </div>
                        <div class="param-item">
                            <div class="param-label">光效类型</div>
                            <div class="param-value" id="light_effect">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- 图片上传（视频模式显示） -->
                <div class="form-group" id="image_upload_group" style="display: none;">
                    <label for="reference_image">🖼️ 参考图片（视频prompt生成需要）：</label>
                    <div class="upload-container">
                        <input type="file" id="reference_image" name="reference_image" accept="image/*" style="display: none;">
                        <button type="button" class="upload-btn" onclick="document.getElementById('reference_image').click()">📁 选择图片</button>
                        <div class="upload-info" id="upload_info">未选择文件</div>
                    </div>
                    <div class="image-preview" id="image_preview" style="display: none;">
                        <img id="preview_img" src="" alt="预览图片" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin-top: 10px;">
                        <button type="button" class="remove-btn" onclick="removeImage()">❌ 移除</button>
                    </div>
                </div>
                
                <!-- 特殊要求 -->
                <!-- 删除这整个form-group -->
                <!-- 
                <div class="form-group">
                    <label for="special_requirements">✨ 特殊要求（可选）：</label>
                    <textarea id="special_requirements" name="special_requirements" placeholder="请输入特殊要求，如：风格、元素、构图、主题、情感氛围等"></textarea>
                </div>
                -->
                
                <button type="button" class="generate-btn" id="generateBtn">🚀 生成 Prompt</button>
                
                <!-- 加载动画 -->
                <div class="loading-container" id="loadingContainer" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">正在生成中，请稍候...</div>
                </div>
            </form>
            
            <!-- 结果显示区域 -->
            <div class="result-container" id="resultContainer">
                <div class="result-box">
                    <h4 id="resultTitle">📝 生成的 Prompt：</h4>
                    <button class="copy-btn" onclick="copyResult()">📋 复制</button>
                    <div class="result-text" id="resultText"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 全局函数定义
        function removeImage() {
            document.getElementById('reference_image').value = '';
            document.getElementById('image_preview').style.display = 'none';
            document.getElementById('upload_info').textContent = '未选择文件';
        }
        
        function copyResult() {
            const mode = document.querySelector('input[name="generation_mode"]:checked').value;
            const resultText = document.getElementById('resultText');
            
            let textToCopy;
            if (mode === 'image') {
                // 获取当前显示的prompt内容
                const promptContent = resultText.textContent || resultText.innerText;
                textToCopy = promptContent;
            } else {
                textToCopy = resultText.textContent;
            }
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '✅ 已复制';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // 价位-类别映射表
            const priceToCategories = {
                '[1,20)': ['日用品', '符号'],
                '[20,99)': ['日用品', '衣鞋', '符号'],
                '[99,200)': ['日用品', '衣鞋', '植物', '食物', '符号'],
                '[299,500)': ['日用品', '衣鞋', '植物', '食物', '符号', '小型装饰'],
                '[500,700)': ['衣鞋', '植物', '食物', '小型装饰', '电子产品'],
                '[700,1k)': ['植物', '食物', '小型装饰', '电子产品', '运动器材'],
                '[1k,2k)': ['小型装饰', '电子产品', '运动器材', '乐器'],
                '[2k,3k)': ['电子产品', '运动器材', '乐器', '家具'],
                '[3k,4k)': ['运动器材', '乐器', '家具', '小型交通工具'],
                '[4k,6k)': ['乐器', '家具', '小型交通工具', '珠宝首饰'],
                '[6k,8k)': ['家具', '小型交通工具', '珠宝首饰', '艺术品'],
                '[8k,1w)': ['小型交通工具', '珠宝首饰', '艺术品', '高端电子'],
                '[1w,1.5w)': ['珠宝首饰', '艺术品', '高端电子', '豪华家具'],
                '[1.5w,2w)': ['艺术品', '高端电子', '豪华家具', '豪华车'],
                '[2w,3w]': ['星际间交通工具', '大型装置设施', '神性动物', '虚拟人物', '大型自然或虚拟场景']
            };
            
            // 价位-视频参数映射表
            const priceToVideoParams = {
                '[1,20)': { duration: '0秒（静态图标）', aspectRatio: '1:1', shotCount: '静态', lightEffect: '无' },
                '[20,99)': { duration: '0秒（静态图片）', aspectRatio: '1:1', shotCount: '静态', lightEffect: '无' },
                '[99,200)': { duration: '1-2秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '低成本闪现效果' },
                '[299,500)': { duration: '1-2秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '单帧动效或极短特效' },
                '[500,700)': { duration: '3秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '静态为主辅以轻微动态' },
                '[700,1k)': { duration: '3秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '单主体特写或小动作' },
                '[1k,2k)': { duration: '4秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '单一主体快速展示' },
                '[2k,3k)': { duration: '4秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '单一主体快速展示' },
                '[3k,4k)': { duration: '5秒', aspectRatio: '1:1', shotCount: '1镜头', lightEffect: '简短特写或单镜头表现' },
                '[4k,6k)': { duration: '5秒', aspectRatio: '1:1', shotCount: '1-2镜头', lightEffect: '适度压缩镜头变化' },
                '[6k,8k)': { duration: '5秒', aspectRatio: '1:1', shotCount: '1-2镜头', lightEffect: '简化运动、局部特效' },
                '[8k,1w)': { duration: '6秒', aspectRatio: '1:1', shotCount: '2镜头', lightEffect: '单主体与小范围运动' },
                '[1w,1.5w)': { duration: '7秒', aspectRatio: '1:1', shotCount: '2-3镜头', lightEffect: '中景与特写结合的表现方式' },
                '[1.5w,2w)': { duration: '8秒', aspectRatio: '1:1', shotCount: '3-4镜头', lightEffect: '精致、多细节元素与中等运镜节奏' },
                '[2w,3w]': { duration: '9秒', aspectRatio: '1:1', shotCount: '4-5镜头', lightEffect: '豪华、大型场景与多镜头运镜' }
            };
            
            // 模式切换
            document.querySelectorAll('input[name="generation_mode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const isVideoMode = this.value === 'video';
                    const categoryGroup = document.getElementById('category_group');
                    const videoParams = document.getElementById('video_params');
                    const imageUploadGroup = document.getElementById('image_upload_group');
                    
                    if (isVideoMode) {
                        categoryGroup.classList.add('hidden');
                        videoParams.classList.add('show');
                        imageUploadGroup.style.display = 'block';
                        updateVideoParams();
                    } else {
                        categoryGroup.classList.remove('hidden');
                        videoParams.classList.remove('show');
                        imageUploadGroup.style.display = 'none';
                    }
                });
            });
            
            // 图片上传处理
            document.getElementById('reference_image').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('preview_img').src = e.target.result;
                        document.getElementById('image_preview').style.display = 'block';
                        document.getElementById('upload_info').textContent = file.name;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // 价位选择变化
            document.getElementById('gift_price_range').addEventListener('change', function() {
                const selectedPrice = this.value;
                updateCategories(selectedPrice);
                updateVideoParams();
            });
            
            // 更新类别显示函数
            function updateCategories(priceRange) {
                const categoryDisplay = document.getElementById('gift_category_display');
                
                if (priceRange && priceToCategories[priceRange]) {
                    const categories = priceToCategories[priceRange].join('、');
                    categoryDisplay.textContent = `${priceRange} 建议对应礼物类别：${categories}`;
                    categoryDisplay.style.color = '#333';
                } else {
                    categoryDisplay.textContent = '请先选择价位查看建议对应礼物类别';
                    categoryDisplay.style.color = '#666';
                }
            }
            
            // 更新视频参数显示
            function updateVideoParams() {
                const priceRange = document.getElementById('gift_price_range').value;
                const isVideoMode = document.querySelector('input[name="generation_mode"]:checked').value === 'video';
                
                if (isVideoMode && priceRange && priceToVideoParams[priceRange]) {
                    const params = priceToVideoParams[priceRange];
                    document.getElementById('duration').textContent = params.duration;
                    document.getElementById('aspect_ratio').textContent = params.aspectRatio;
                    document.getElementById('shot_count').textContent = params.shotCount;
                    document.getElementById('light_effect').textContent = params.lightEffect;
                }
            }
            
            // 只保留按钮点击事件监听器
            document.getElementById('generateBtn').addEventListener('click', function(e) {
                e.preventDefault();
                generatePrompt();
            });
            
            // 在generatePrompt函数之前定义styleTemplate（全局作用域）
            // 在第540行左右，styleTemplate定义之前添加
            // 图片转Base64的辅助函数
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        const base64 = reader.result.split(',')[1]; // 移除data:image/jpeg;base64,前缀
                        resolve(base64);
                    };
                    reader.onerror = error => reject(error);
                });
            }
            
            const styleTemplate = {
                positive: "3D拟物卡通化渲染，边缘圆润厚实有体积感，造型比例略夸张可爱，厚涂光泽质感带有柔和反光，细节干净利落无杂乱元素，颜色饱和度高且带柔和渐变过渡，局部有明亮高光点缀与温暖背光光晕，光影过渡夸张有戏剧性表现力，材质简洁且符号化细节明显，整体氛围温馨、节庆、欢乐喜悦，背景干净简洁且带有柔焦光晕效果，色彩搭配统一协调有设计感",
                negative: "photo-realistic, realistic, 写实, 真实感, 写实渲染, 高清摄影, PBR, 写实贴图, 自然光摄影, 真实材质, 真实阴影, 物理渲染, 超真实, 摄影感"
            };
            
            // 生成Prompt函数
            async function generatePrompt() {
                const generateBtn = document.getElementById('generateBtn');
                const loadingContainer = document.getElementById('loadingContainer');
                const resultContainer = document.getElementById('resultContainer');
                
                // 显示加载动画，禁用按钮
                generateBtn.disabled = true;
                generateBtn.textContent = '生成中...';
                loadingContainer.style.display = 'block';
                resultContainer.classList.remove('show');
                
                // 在generatePrompt函数中，替换验证部分
const mode = document.querySelector('input[name="generation_mode"]:checked').value;
const priceRange = document.getElementById('gift_price_range').value;
const inspirationWords = document.getElementById('inspiration_words').value; // 添加这行

if (!priceRange) {
    alert('请选择价位区间');
    generateBtn.disabled = false;
    generateBtn.textContent = '🚀 生成 Prompt';
    loadingContainer.style.display = 'none';
    return;
}

// 添加灵感词验证
if (!inspirationWords.trim()) {
    alert('请输入灵感词');
    generateBtn.disabled = false;
    generateBtn.textContent = '🚀 生成 Prompt';
    loadingContainer.style.display = 'none';
    return;
}
                let systemPrompt, userInput;
                
                if (mode === 'image') {
                    // 删除礼物类别的获取和使用
                    // const giftCategory = document.getElementById('gift_category').value;
                    
                    systemPrompt = `你是一个专业的图片Prompt生成助手。请根据用户提供的价位和灵感词，生成符合以下要求的图片Prompt：

必须包含：
1. 符合价位的风格定位
2. 适合的色彩搭配
3. 合适的构图和视觉效果
4. 根据价位适配的细节丰富度

**价位特殊要求：**
- 如果价位在500以下（包含[1,20)、[20,99)、[99,200)、[200,500)等区间），必须使用纯黑色背景，且不添加任何光效。
- 如果价位在500-1000（包含[500,1k)等区间），使用纯色背景或简单单调的背景，且不添加任何光效。
- 如果价位在1000以上（包含[1k,2k)、[2k,3k)等区间），可以使用丰富的背景设计，并可以添加氛围光效，如体积光、环境光、反射光、粒子光效等。

**重要：请用中文生成prompt，确保内容丰富且符合灵感词主题。**

${styleTemplate.positive}`;
                    
                    userInput = `价位：${priceRange}\n灵感词：${inspirationWords}`; // ✅ 添加灵感词
                } else {
                    // 视频模式的systemPrompt和userInput也相应简化
                    const imageFile = document.getElementById('reference_image').files[0];
                    let imageAnalysis = '';
                    
                    if (imageFile) {
                        imageAnalysis = '\n\n请根据用户上传的参考图片进行分析，提取其中的：\n- 主要元素和物体\n- 色彩搭配\n- 构图风格\n- 光影效果\n- 整体氛围\n\n并将这些元素融入到视频prompt的生成中。';
                    }
                    
                    systemPrompt = `你是一个专业的视频Prompt生成助手。请根据用户提供的价位${imageFile ? '和参考图片' : ''}，生成符合以下要求的视频Prompt：

必须包含：
1. 镜头语言（推进/拉远/横移/环绕/俯拍等）
2. 景别（特写/近景/中景/远景/全景）
3. 动态特效（粒子、轨迹、体积光、反射等）
4. 根据价位适配的场景复杂度和运镜节奏

**价位特殊要求：**
- 如果价位在500以下（包含[1,20)、[20,99)、[99,200)、[200,500)等区间），必须使用纯黑色背景，且不添加任何光效。
- 如果价位在500-1000（包含[500,1k)等区间），使用纯色背景或简单单调的背景，且不添加任何光效。
- 如果价位在1000以上（包含[1k,2k)、[2k,3k)等区间），可以使用丰富的背景设计，并可以添加氛围光效，如体积光、环境光、反射光、粒子光效等。

**重要：请用中文生成prompt，确保内容丰富且符合灵感词主题。**

注意：不要在生成的prompt中包含具体的时长、屏占比、镜头数等技术参数，这些仅作为内部制作参考。${imageAnalysis}`;
                    
                    // 图片模式
                    userInput = `价位：${priceRange}\n灵感词：${inspirationWords}`;
                    
                    // 视频模式  
                    userInput = `价位：${priceRange}\n灵感词：${inspirationWords}${imageFile ? '\n\n[用户已上传参考图片，请结合图片内容进行分析]' : ''}`;
                }
                
                // 在generatePrompt函数中，替换API调用部分
                try {
                    const apiKey = document.getElementById('apiKey').value;
                    const apiBase = document.getElementById('apiBase').value;
                    
                    if (!apiKey || !apiBase) {
                        alert('请先配置API密钥和基础URL');
                        return;
                    }
                    
                    // 构建消息数组
                    let messages = [
                        { role: 'system', content: systemPrompt }
                    ];
                    
                    // 检查是否为视频模式且有图片上传
                    if (mode === 'video') {
                        const imageFile = document.getElementById('reference_image').files[0];
                        
                        if (imageFile) {
                            // 将图片转换为base64
                            const base64Image = await fileToBase64(imageFile);
                            
                            messages.push({
                                role: 'user',
                                content: [
                                    { type: 'text', text: userInput },
                                    { 
                                        type: 'image_url',
                                        image_url: {
                                            url: `data:image/jpeg;base64,${base64Image}`
                                        }
                                    }
                                ]
                            });
                        } else {
                            messages.push({ role: 'user', content: userInput });
                        }
                    } else {
                        // 图片模式只发送文本
                        messages.push({ role: 'user', content: userInput });
                    }
                    
                    const response = await fetch(apiBase + '/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'ep-20250814140052-84jt2', // 更换为Doubao模型
                            messages: messages,
                            temperature: 0.7,
                            max_tokens: 1200
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API请求失败: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const prompt = data.choices[0].message.content;
                    
                    showResult(prompt, mode);
                } catch (error) {
                    alert('生成失败：' + error.message);
                } finally {
                    // 隐藏加载动画，恢复按钮
                    generateBtn.disabled = false;
                    generateBtn.textContent = '🚀 生成 Prompt';
                    loadingContainer.style.display = 'none';
                }
            }
            
            // 显示结果
            // 修改showResult函数
            function showResult(prompt, mode) {
                const resultContainer = document.getElementById('resultContainer');
                const resultTitle = document.getElementById('resultTitle');
                const resultText = document.getElementById('resultText');
                
                if (mode === 'image') {
                    resultTitle.textContent = '📸 图片 Prompt：';
                    // 直接显示prompt，不添加标题和负面提示词
                    resultText.textContent = prompt;
                } else {
                    resultTitle.textContent = '🎬 视频 Prompt：';
                    resultText.textContent = prompt;
                }
                
                resultContainer.classList.add('show');
                
                // 滚动到结果区域
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
