<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ AIç¤¼ç‰©PromptåŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .mode-selector {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .mode-option {
            position: relative;
        }
        
        .mode-option input[type="radio"] {
            display: none;
        }
        
        .mode-option label {
            display: block;
            padding: 15px 30px;
            border: 3px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            min-width: 200px;
        }
        
        .mode-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }
        
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .video-params {
            display: none;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .video-params.show {
            display: block;
        }
        
        .video-params h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .param-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .param-label {
            font-weight: bold;
            color: #666;
            font-size: 14px;
        }
        
        .param-value {
            font-size: 16px;
            color: #333;
            margin-top: 5px;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin: 20px 0;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* åŠ è½½åŠ¨ç”»æ ·å¼ */
        .loading-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #667eea;
            font-size: 16px;
            font-weight: bold;
        }
        
        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-container {
            margin-top: 30px;
            display: none;
        }
        
        .result-container.show {
            display: block;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }
        
        .result-box h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .result-text {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: monospace;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .copy-btn:hover {
            background: #218838;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ AIç¤¼ç‰©PromptåŠ©æ‰‹</h1>
        </div>
        
        <div class="form-container">
            <!-- éšè—APIé…ç½® -->
            <div style="display: none;">
                <input type="hidden" id="apiKey" value="4bdc017d-23e8-4ea6-b57a-cb9f85bdf72f">
                <input type="hidden" id="apiBase" value="https://ark-cn-beijing.bytedance.net/api/v3">
            </div>
            
            <form id="promptForm">
                <!-- æ¨¡å¼é€‰æ‹© -->
                <div class="form-group">
                    <label>ğŸ¯ ç”Ÿæˆæ¨¡å¼ï¼š</label>
                    <div class="mode-selector">
                        <div class="mode-option">
                            <input type="radio" id="image_mode" name="generation_mode" value="image" checked>
                            <label for="image_mode">ğŸ“¸ å›¾ç‰‡ Prompt æ¨¡å¼</label>
                        </div>
                        <div class="mode-option">
                            <input type="radio" id="video_mode" name="generation_mode" value="video">
                            <label for="video_mode">ğŸ¬ è§†é¢‘ Prompt æ¨¡å¼</label>
                        </div>
                    </div>
                </div>
                
                <!-- ç¤¼ç‰©ä»·ä½é€‰æ‹©ï¼ˆå¿…é€‰ï¼‰ -->
                <div class="form-group">
                    <label for="gift_price_range">ğŸ’ ç¤¼ç‰©ä»·ä½ï¼ˆé’»ï¼‰<span style="color: red;">*</span>ï¼š</label>
                    <select id="gift_price_range" name="gift_price_range" required>
                        <option value="">è¯·é€‰æ‹©ä»·ä½èŒƒå›´</option>
                        <option value="[1,20)">[1,20) - 1-20é’»</option>
                        <option value="[20,99)">[20,99) - 20-99é’»</option>
                        <option value="[99,200)">[99,200) - 99-200é’»</option>
                        <option value="[299,500)">[299,500) - 299-500é’»</option>
                        <option value="[500,700)">[500,700) - 500-700é’»</option>
                        <option value="[700,1k)">[700,1k) - 700-1åƒé’»</option>
                        <option value="[1k,2k)">[1k,2k) - 1åƒ-2åƒé’»</option>
                        <option value="[2k,3k)">[2k,3k) - 2åƒ-3åƒé’»</option>
            
                    </select>
                </div>
                
                <!-- ç¤¼ç‰©ç±»åˆ«ï¼ˆå‚è€ƒä¿¡æ¯æ˜¾ç¤ºï¼‰ -->
                <div class="form-group" id="category_group">
                    <label>ğŸ ç¤¼ç‰©ç±»åˆ«ï¼ˆå‚è€ƒä¿¡æ¯ï¼‰ï¼š</label>
                    <div id="gift_category_display" style="padding: 10px; background-color: #f5f5f5; border-radius: 5px; color: #666; font-size: 14px;">
                        è¯·å…ˆé€‰æ‹©ä»·ä½æŸ¥çœ‹å»ºè®®å¯¹åº”ç¤¼ç‰©ç±»åˆ«
                    </div>
                </div>
                
                <!-- çµæ„Ÿè¯è¾“å…¥ï¼ˆå¿…é€‰ï¼‰ -->
                <div class="form-group">
                    <label for="inspiration_words">ğŸ’¡ çµæ„Ÿè¯<span style="color: red;">*</span>ï¼š</label>
                    <textarea id="inspiration_words" name="inspiration_words" placeholder="è¯·è¾“å…¥çµæ„Ÿè¯ï¼Œå¦‚ï¼šé£æ ¼ã€å…ƒç´ ã€æ„å›¾ã€ä¸»é¢˜ã€æƒ…æ„Ÿæ°›å›´ç­‰" required></textarea>
                </div>
                
                <!-- è§†é¢‘åˆ¶ä½œå‚æ•°æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="video-params" id="video_params">
                    <h4>ğŸ¬ è§†é¢‘åˆ¶ä½œå‚æ•°ï¼ˆæ ¹æ®ä»·ä½è‡ªåŠ¨æ˜ å°„ï¼‰</h4>
                    <div class="param-grid">
                        <div class="param-item">
                            <div class="param-label">æ—¶é•¿</div>
                            <div class="param-value" id="duration">-</div>
                        </div>
                        <div class="param-item">
                            <div class="param-label">å±å æ¯”</div>
                            <div class="param-value" id="aspect_ratio">-</div>
                        </div>
                        <div class="param-item">
                            <div class="param-label">é•œå¤´æ•°</div>
                            <div class="param-value" id="shot_count">-</div>
                        </div>
                        <div class="param-item">
                            <div class="param-label">å…‰æ•ˆç±»å‹</div>
                            <div class="param-value" id="light_effect">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- å›¾ç‰‡ä¸Šä¼ ï¼ˆè§†é¢‘æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                <div class="form-group" id="image_upload_group" style="display: none;">
                    <label for="reference_image">ğŸ–¼ï¸ å‚è€ƒå›¾ç‰‡ï¼ˆè§†é¢‘promptç”Ÿæˆéœ€è¦ï¼‰ï¼š</label>
                    <div class="upload-container">
                        <input type="file" id="reference_image" name="reference_image" accept="image/*" style="display: none;">
                        <button type="button" class="upload-btn" onclick="document.getElementById('reference_image').click()">ğŸ“ é€‰æ‹©å›¾ç‰‡</button>
                        <div class="upload-info" id="upload_info">æœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>
                    <div class="image-preview" id="image_preview" style="display: none;">
                        <img id="preview_img" src="" alt="é¢„è§ˆå›¾ç‰‡" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin-top: 10px;">
                        <button type="button" class="remove-btn" onclick="removeImage()">âŒ ç§»é™¤</button>
                    </div>
                </div>
                
                <!-- ç‰¹æ®Šè¦æ±‚ -->
                <!-- åˆ é™¤è¿™æ•´ä¸ªform-group -->
                <!-- 
                <div class="form-group">
                    <label for="special_requirements">âœ¨ ç‰¹æ®Šè¦æ±‚ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                    <textarea id="special_requirements" name="special_requirements" placeholder="è¯·è¾“å…¥ç‰¹æ®Šè¦æ±‚ï¼Œå¦‚ï¼šé£æ ¼ã€å…ƒç´ ã€æ„å›¾ã€ä¸»é¢˜ã€æƒ…æ„Ÿæ°›å›´ç­‰"></textarea>
                </div>
                -->
                
                <button type="button" class="generate-btn" id="generateBtn">ğŸš€ ç”Ÿæˆ Prompt</button>
                
                <!-- åŠ è½½åŠ¨ç”» -->
                <div class="loading-container" id="loadingContainer" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</div>
                </div>
            </form>
            
            <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="result-container" id="resultContainer">
                <div class="result-box">
                    <h4 id="resultTitle">ğŸ“ ç”Ÿæˆçš„ Promptï¼š</h4>
                    <button class="copy-btn" onclick="copyResult()">ğŸ“‹ å¤åˆ¶</button>
                    <div class="result-text" id="resultText"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å‡½æ•°å®šä¹‰
        function removeImage() {
            document.getElementById('reference_image').value = '';
            document.getElementById('image_preview').style.display = 'none';
            document.getElementById('upload_info').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
        }
        
        function copyResult() {
            const mode = document.querySelector('input[name="generation_mode"]:checked').value;
            const resultText = document.getElementById('resultText');
            
            let textToCopy;
            if (mode === 'image') {
                // è·å–å½“å‰æ˜¾ç¤ºçš„promptå†…å®¹
                const promptContent = resultText.textContent || resultText.innerText;
                textToCopy = promptContent;
            } else {
                textToCopy = resultText.textContent;
            }
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'âœ… å·²å¤åˆ¶';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // ä»·ä½-ç±»åˆ«æ˜ å°„è¡¨
            const priceToCategories = {
                '[1,20)': ['æ—¥ç”¨å“', 'ç¬¦å·'],
                '[20,99)': ['æ—¥ç”¨å“', 'è¡£é‹', 'ç¬¦å·'],
                '[99,200)': ['æ—¥ç”¨å“', 'è¡£é‹', 'æ¤ç‰©', 'é£Ÿç‰©', 'ç¬¦å·'],
                '[299,500)': ['æ—¥ç”¨å“', 'è¡£é‹', 'æ¤ç‰©', 'é£Ÿç‰©', 'ç¬¦å·', 'å°å‹è£…é¥°'],
                '[500,700)': ['è¡£é‹', 'æ¤ç‰©', 'é£Ÿç‰©', 'å°å‹è£…é¥°', 'ç”µå­äº§å“'],
                '[700,1k)': ['æ¤ç‰©', 'é£Ÿç‰©', 'å°å‹è£…é¥°', 'ç”µå­äº§å“', 'è¿åŠ¨å™¨æ'],
                '[1k,2k)': ['å°å‹è£…é¥°', 'ç”µå­äº§å“', 'è¿åŠ¨å™¨æ', 'ä¹å™¨'],
                '[2k,3k)': ['ç”µå­äº§å“', 'è¿åŠ¨å™¨æ', 'ä¹å™¨', 'å®¶å…·'],
                '[3k,4k)': ['è¿åŠ¨å™¨æ', 'ä¹å™¨', 'å®¶å…·', 'å°å‹äº¤é€šå·¥å…·'],
                '[4k,6k)': ['ä¹å™¨', 'å®¶å…·', 'å°å‹äº¤é€šå·¥å…·', 'ç å®é¦–é¥°'],
                '[6k,8k)': ['å®¶å…·', 'å°å‹äº¤é€šå·¥å…·', 'ç å®é¦–é¥°', 'è‰ºæœ¯å“'],
                '[8k,1w)': ['å°å‹äº¤é€šå·¥å…·', 'ç å®é¦–é¥°', 'è‰ºæœ¯å“', 'é«˜ç«¯ç”µå­'],
                '[1w,1.5w)': ['ç å®é¦–é¥°', 'è‰ºæœ¯å“', 'é«˜ç«¯ç”µå­', 'è±ªåå®¶å…·'],
                '[1.5w,2w)': ['è‰ºæœ¯å“', 'é«˜ç«¯ç”µå­', 'è±ªåå®¶å…·', 'è±ªåè½¦'],
                '[2w,3w]': ['æ˜Ÿé™…é—´äº¤é€šå·¥å…·', 'å¤§å‹è£…ç½®è®¾æ–½', 'ç¥æ€§åŠ¨ç‰©', 'è™šæ‹Ÿäººç‰©', 'å¤§å‹è‡ªç„¶æˆ–è™šæ‹Ÿåœºæ™¯']
            };
            
            // ä»·ä½-è§†é¢‘å‚æ•°æ˜ å°„è¡¨
            const priceToVideoParams = {
                '[1,20)': { duration: '0ç§’ï¼ˆé™æ€å›¾æ ‡ï¼‰', aspectRatio: '1:1', shotCount: 'é™æ€', lightEffect: 'æ— ' },
                '[20,99)': { duration: '0ç§’ï¼ˆé™æ€å›¾ç‰‡ï¼‰', aspectRatio: '1:1', shotCount: 'é™æ€', lightEffect: 'æ— ' },
                '[99,200)': { duration: '1-2ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'ä½æˆæœ¬é—ªç°æ•ˆæœ' },
                '[299,500)': { duration: '1-2ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'å•å¸§åŠ¨æ•ˆæˆ–æçŸ­ç‰¹æ•ˆ' },
                '[500,700)': { duration: '3ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'é™æ€ä¸ºä¸»è¾…ä»¥è½»å¾®åŠ¨æ€' },
                '[700,1k)': { duration: '3ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'å•ä¸»ä½“ç‰¹å†™æˆ–å°åŠ¨ä½œ' },
                '[1k,2k)': { duration: '4ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'å•ä¸€ä¸»ä½“å¿«é€Ÿå±•ç¤º' },
                '[2k,3k)': { duration: '4ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'å•ä¸€ä¸»ä½“å¿«é€Ÿå±•ç¤º' },
                '[3k,4k)': { duration: '5ç§’', aspectRatio: '1:1', shotCount: '1é•œå¤´', lightEffect: 'ç®€çŸ­ç‰¹å†™æˆ–å•é•œå¤´è¡¨ç°' },
                '[4k,6k)': { duration: '5ç§’', aspectRatio: '1:1', shotCount: '1-2é•œå¤´', lightEffect: 'é€‚åº¦å‹ç¼©é•œå¤´å˜åŒ–' },
                '[6k,8k)': { duration: '5ç§’', aspectRatio: '1:1', shotCount: '1-2é•œå¤´', lightEffect: 'ç®€åŒ–è¿åŠ¨ã€å±€éƒ¨ç‰¹æ•ˆ' },
                '[8k,1w)': { duration: '6ç§’', aspectRatio: '1:1', shotCount: '2é•œå¤´', lightEffect: 'å•ä¸»ä½“ä¸å°èŒƒå›´è¿åŠ¨' },
                '[1w,1.5w)': { duration: '7ç§’', aspectRatio: '1:1', shotCount: '2-3é•œå¤´', lightEffect: 'ä¸­æ™¯ä¸ç‰¹å†™ç»“åˆçš„è¡¨ç°æ–¹å¼' },
                '[1.5w,2w)': { duration: '8ç§’', aspectRatio: '1:1', shotCount: '3-4é•œå¤´', lightEffect: 'ç²¾è‡´ã€å¤šç»†èŠ‚å…ƒç´ ä¸ä¸­ç­‰è¿é•œèŠ‚å¥' },
                '[2w,3w]': { duration: '9ç§’', aspectRatio: '1:1', shotCount: '4-5é•œå¤´', lightEffect: 'è±ªåã€å¤§å‹åœºæ™¯ä¸å¤šé•œå¤´è¿é•œ' }
            };
            
            // æ¨¡å¼åˆ‡æ¢
            document.querySelectorAll('input[name="generation_mode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const isVideoMode = this.value === 'video';
                    const categoryGroup = document.getElementById('category_group');
                    const videoParams = document.getElementById('video_params');
                    const imageUploadGroup = document.getElementById('image_upload_group');
                    
                    if (isVideoMode) {
                        categoryGroup.classList.add('hidden');
                        videoParams.classList.add('show');
                        imageUploadGroup.style.display = 'block';
                        updateVideoParams();
                    } else {
                        categoryGroup.classList.remove('hidden');
                        videoParams.classList.remove('show');
                        imageUploadGroup.style.display = 'none';
                    }
                });
            });
            
            // å›¾ç‰‡ä¸Šä¼ å¤„ç†
            document.getElementById('reference_image').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('preview_img').src = e.target.result;
                        document.getElementById('image_preview').style.display = 'block';
                        document.getElementById('upload_info').textContent = file.name;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // ä»·ä½é€‰æ‹©å˜åŒ–
            document.getElementById('gift_price_range').addEventListener('change', function() {
                const selectedPrice = this.value;
                updateCategories(selectedPrice);
                updateVideoParams();
            });
            
            // æ›´æ–°ç±»åˆ«æ˜¾ç¤ºå‡½æ•°
            function updateCategories(priceRange) {
                const categoryDisplay = document.getElementById('gift_category_display');
                
                if (priceRange && priceToCategories[priceRange]) {
                    const categories = priceToCategories[priceRange].join('ã€');
                    categoryDisplay.textContent = `${priceRange} å»ºè®®å¯¹åº”ç¤¼ç‰©ç±»åˆ«ï¼š${categories}`;
                    categoryDisplay.style.color = '#333';
                } else {
                    categoryDisplay.textContent = 'è¯·å…ˆé€‰æ‹©ä»·ä½æŸ¥çœ‹å»ºè®®å¯¹åº”ç¤¼ç‰©ç±»åˆ«';
                    categoryDisplay.style.color = '#666';
                }
            }
            
            // æ›´æ–°è§†é¢‘å‚æ•°æ˜¾ç¤º
            function updateVideoParams() {
                const priceRange = document.getElementById('gift_price_range').value;
                const isVideoMode = document.querySelector('input[name="generation_mode"]:checked').value === 'video';
                
                if (isVideoMode && priceRange && priceToVideoParams[priceRange]) {
                    const params = priceToVideoParams[priceRange];
                    document.getElementById('duration').textContent = params.duration;
                    document.getElementById('aspect_ratio').textContent = params.aspectRatio;
                    document.getElementById('shot_count').textContent = params.shotCount;
                    document.getElementById('light_effect').textContent = params.lightEffect;
                }
            }
            
            // åªä¿ç•™æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('generateBtn').addEventListener('click', function(e) {
                e.preventDefault();
                generatePrompt();
            });
            
            // åœ¨generatePromptå‡½æ•°ä¹‹å‰å®šä¹‰styleTemplateï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰
            // åœ¨ç¬¬540è¡Œå·¦å³ï¼ŒstyleTemplateå®šä¹‰ä¹‹å‰æ·»åŠ 
            // å›¾ç‰‡è½¬Base64çš„è¾…åŠ©å‡½æ•°
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        const base64 = reader.result.split(',')[1]; // ç§»é™¤data:image/jpeg;base64,å‰ç¼€
                        resolve(base64);
                    };
                    reader.onerror = error => reject(error);
                });
            }
            
            const styleTemplate = {
                positive: "3Dæ‹Ÿç‰©å¡é€šåŒ–æ¸²æŸ“ï¼Œè¾¹ç¼˜åœ†æ¶¦åšå®æœ‰ä½“ç§¯æ„Ÿï¼Œé€ å‹æ¯”ä¾‹ç•¥å¤¸å¼ å¯çˆ±ï¼Œåšæ¶‚å…‰æ³½è´¨æ„Ÿå¸¦æœ‰æŸ”å’Œåå…‰ï¼Œç»†èŠ‚å¹²å‡€åˆ©è½æ— æ‚ä¹±å…ƒç´ ï¼Œé¢œè‰²é¥±å’Œåº¦é«˜ä¸”å¸¦æŸ”å’Œæ¸å˜è¿‡æ¸¡ï¼Œå±€éƒ¨æœ‰æ˜äº®é«˜å…‰ç‚¹ç¼€ä¸æ¸©æš–èƒŒå…‰å…‰æ™•ï¼Œå…‰å½±è¿‡æ¸¡å¤¸å¼ æœ‰æˆå‰§æ€§è¡¨ç°åŠ›ï¼Œæè´¨ç®€æ´ä¸”ç¬¦å·åŒ–ç»†èŠ‚æ˜æ˜¾ï¼Œæ•´ä½“æ°›å›´æ¸©é¦¨ã€èŠ‚åº†ã€æ¬¢ä¹å–œæ‚¦ï¼ŒèƒŒæ™¯å¹²å‡€ç®€æ´ä¸”å¸¦æœ‰æŸ”ç„¦å…‰æ™•æ•ˆæœï¼Œè‰²å½©æ­é…ç»Ÿä¸€åè°ƒæœ‰è®¾è®¡æ„Ÿ",
                negative: "photo-realistic, realistic, å†™å®, çœŸå®æ„Ÿ, å†™å®æ¸²æŸ“, é«˜æ¸…æ‘„å½±, PBR, å†™å®è´´å›¾, è‡ªç„¶å…‰æ‘„å½±, çœŸå®æè´¨, çœŸå®é˜´å½±, ç‰©ç†æ¸²æŸ“, è¶…çœŸå®, æ‘„å½±æ„Ÿ"
            };
            
            // ç”ŸæˆPromptå‡½æ•°
            async function generatePrompt() {
                const generateBtn = document.getElementById('generateBtn');
                const loadingContainer = document.getElementById('loadingContainer');
                const resultContainer = document.getElementById('resultContainer');
                
                // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œç¦ç”¨æŒ‰é’®
                generateBtn.disabled = true;
                generateBtn.textContent = 'ç”Ÿæˆä¸­...';
                loadingContainer.style.display = 'block';
                resultContainer.classList.remove('show');
                
                // åœ¨generatePromptå‡½æ•°ä¸­ï¼Œæ›¿æ¢éªŒè¯éƒ¨åˆ†
const mode = document.querySelector('input[name="generation_mode"]:checked').value;
const priceRange = document.getElementById('gift_price_range').value;
const inspirationWords = document.getElementById('inspiration_words').value; // æ·»åŠ è¿™è¡Œ

if (!priceRange) {
    alert('è¯·é€‰æ‹©ä»·ä½åŒºé—´');
    generateBtn.disabled = false;
    generateBtn.textContent = 'ğŸš€ ç”Ÿæˆ Prompt';
    loadingContainer.style.display = 'none';
    return;
}

// æ·»åŠ çµæ„Ÿè¯éªŒè¯
if (!inspirationWords.trim()) {
    alert('è¯·è¾“å…¥çµæ„Ÿè¯');
    generateBtn.disabled = false;
    generateBtn.textContent = 'ğŸš€ ç”Ÿæˆ Prompt';
    loadingContainer.style.display = 'none';
    return;
}
                let systemPrompt, userInput;
                
                if (mode === 'image') {
                    // åˆ é™¤ç¤¼ç‰©ç±»åˆ«çš„è·å–å’Œä½¿ç”¨
                    // const giftCategory = document.getElementById('gift_category').value;
                    
                    systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å›¾ç‰‡Promptç”ŸæˆåŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·æä¾›çš„ä»·ä½å’Œçµæ„Ÿè¯ï¼Œç”Ÿæˆç¬¦åˆä»¥ä¸‹è¦æ±‚çš„å›¾ç‰‡Promptï¼š

å¿…é¡»åŒ…å«ï¼š
1. ç¬¦åˆä»·ä½çš„é£æ ¼å®šä½
2. é€‚åˆçš„è‰²å½©æ­é…
3. åˆé€‚çš„æ„å›¾å’Œè§†è§‰æ•ˆæœ
4. æ ¹æ®ä»·ä½é€‚é…çš„ç»†èŠ‚ä¸°å¯Œåº¦

**ä»·ä½ç‰¹æ®Šè¦æ±‚ï¼š**
- å¦‚æœä»·ä½åœ¨500ä»¥ä¸‹ï¼ˆåŒ…å«[1,20)ã€[20,99)ã€[99,200)ã€[200,500)ç­‰åŒºé—´ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨çº¯é»‘è‰²èƒŒæ™¯ï¼Œä¸”ä¸æ·»åŠ ä»»ä½•å…‰æ•ˆã€‚
- å¦‚æœä»·ä½åœ¨500-1000ï¼ˆåŒ…å«[500,1k)ç­‰åŒºé—´ï¼‰ï¼Œä½¿ç”¨çº¯è‰²èƒŒæ™¯æˆ–ç®€å•å•è°ƒçš„èƒŒæ™¯ï¼Œä¸”ä¸æ·»åŠ ä»»ä½•å…‰æ•ˆã€‚
- å¦‚æœä»·ä½åœ¨1000ä»¥ä¸Šï¼ˆåŒ…å«[1k,2k)ã€[2k,3k)ç­‰åŒºé—´ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸°å¯Œçš„èƒŒæ™¯è®¾è®¡ï¼Œå¹¶å¯ä»¥æ·»åŠ æ°›å›´å…‰æ•ˆï¼Œå¦‚ä½“ç§¯å…‰ã€ç¯å¢ƒå…‰ã€åå°„å…‰ã€ç²’å­å…‰æ•ˆç­‰ã€‚

**é‡è¦ï¼šè¯·ç”¨ä¸­æ–‡ç”Ÿæˆpromptï¼Œç¡®ä¿å†…å®¹ä¸°å¯Œä¸”ç¬¦åˆçµæ„Ÿè¯ä¸»é¢˜ã€‚**

${styleTemplate.positive}`;
                    
                    userInput = `ä»·ä½ï¼š${priceRange}\nçµæ„Ÿè¯ï¼š${inspirationWords}`; // âœ… æ·»åŠ çµæ„Ÿè¯
                } else {
                    // è§†é¢‘æ¨¡å¼çš„systemPromptå’ŒuserInputä¹Ÿç›¸åº”ç®€åŒ–
                    const imageFile = document.getElementById('reference_image').files[0];
                    let imageAnalysis = '';
                    
                    if (imageFile) {
                        imageAnalysis = '\n\nè¯·æ ¹æ®ç”¨æˆ·ä¸Šä¼ çš„å‚è€ƒå›¾ç‰‡è¿›è¡Œåˆ†æï¼Œæå–å…¶ä¸­çš„ï¼š\n- ä¸»è¦å…ƒç´ å’Œç‰©ä½“\n- è‰²å½©æ­é…\n- æ„å›¾é£æ ¼\n- å…‰å½±æ•ˆæœ\n- æ•´ä½“æ°›å›´\n\nå¹¶å°†è¿™äº›å…ƒç´ èå…¥åˆ°è§†é¢‘promptçš„ç”Ÿæˆä¸­ã€‚';
                    }
                    
                    systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§†é¢‘Promptç”ŸæˆåŠ©æ‰‹ã€‚è¯·æ ¹æ®ç”¨æˆ·æä¾›çš„ä»·ä½${imageFile ? 'å’Œå‚è€ƒå›¾ç‰‡' : ''}ï¼Œç”Ÿæˆç¬¦åˆä»¥ä¸‹è¦æ±‚çš„è§†é¢‘Promptï¼š

å¿…é¡»åŒ…å«ï¼š
1. é•œå¤´è¯­è¨€ï¼ˆæ¨è¿›/æ‹‰è¿œ/æ¨ªç§»/ç¯ç»•/ä¿¯æ‹ç­‰ï¼‰
2. æ™¯åˆ«ï¼ˆç‰¹å†™/è¿‘æ™¯/ä¸­æ™¯/è¿œæ™¯/å…¨æ™¯ï¼‰
3. åŠ¨æ€ç‰¹æ•ˆï¼ˆç²’å­ã€è½¨è¿¹ã€ä½“ç§¯å…‰ã€åå°„ç­‰ï¼‰
4. æ ¹æ®ä»·ä½é€‚é…çš„åœºæ™¯å¤æ‚åº¦å’Œè¿é•œèŠ‚å¥

**ä»·ä½ç‰¹æ®Šè¦æ±‚ï¼š**
- å¦‚æœä»·ä½åœ¨500ä»¥ä¸‹ï¼ˆåŒ…å«[1,20)ã€[20,99)ã€[99,200)ã€[200,500)ç­‰åŒºé—´ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨çº¯é»‘è‰²èƒŒæ™¯ï¼Œä¸”ä¸æ·»åŠ ä»»ä½•å…‰æ•ˆã€‚
- å¦‚æœä»·ä½åœ¨500-1000ï¼ˆåŒ…å«[500,1k)ç­‰åŒºé—´ï¼‰ï¼Œä½¿ç”¨çº¯è‰²èƒŒæ™¯æˆ–ç®€å•å•è°ƒçš„èƒŒæ™¯ï¼Œä¸”ä¸æ·»åŠ ä»»ä½•å…‰æ•ˆã€‚
- å¦‚æœä»·ä½åœ¨1000ä»¥ä¸Šï¼ˆåŒ…å«[1k,2k)ã€[2k,3k)ç­‰åŒºé—´ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸°å¯Œçš„èƒŒæ™¯è®¾è®¡ï¼Œå¹¶å¯ä»¥æ·»åŠ æ°›å›´å…‰æ•ˆï¼Œå¦‚ä½“ç§¯å…‰ã€ç¯å¢ƒå…‰ã€åå°„å…‰ã€ç²’å­å…‰æ•ˆç­‰ã€‚

**é‡è¦ï¼šè¯·ç”¨ä¸­æ–‡ç”Ÿæˆpromptï¼Œç¡®ä¿å†…å®¹ä¸°å¯Œä¸”ç¬¦åˆçµæ„Ÿè¯ä¸»é¢˜ã€‚**

æ³¨æ„ï¼šä¸è¦åœ¨ç”Ÿæˆçš„promptä¸­åŒ…å«å…·ä½“çš„æ—¶é•¿ã€å±å æ¯”ã€é•œå¤´æ•°ç­‰æŠ€æœ¯å‚æ•°ï¼Œè¿™äº›ä»…ä½œä¸ºå†…éƒ¨åˆ¶ä½œå‚è€ƒã€‚${imageAnalysis}`;
                    
                    // å›¾ç‰‡æ¨¡å¼
                    userInput = `ä»·ä½ï¼š${priceRange}\nçµæ„Ÿè¯ï¼š${inspirationWords}`;
                    
                    // è§†é¢‘æ¨¡å¼  
                    userInput = `ä»·ä½ï¼š${priceRange}\nçµæ„Ÿè¯ï¼š${inspirationWords}${imageFile ? '\n\n[ç”¨æˆ·å·²ä¸Šä¼ å‚è€ƒå›¾ç‰‡ï¼Œè¯·ç»“åˆå›¾ç‰‡å†…å®¹è¿›è¡Œåˆ†æ]' : ''}`;
                }
                
                // åœ¨generatePromptå‡½æ•°ä¸­ï¼Œæ›¿æ¢APIè°ƒç”¨éƒ¨åˆ†
                try {
                    const apiKey = document.getElementById('apiKey').value;
                    const apiBase = document.getElementById('apiBase').value;
                    
                    if (!apiKey || !apiBase) {
                        alert('è¯·å…ˆé…ç½®APIå¯†é’¥å’ŒåŸºç¡€URL');
                        return;
                    }
                    
                    // æ„å»ºæ¶ˆæ¯æ•°ç»„
                    let messages = [
                        { role: 'system', content: systemPrompt }
                    ];
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸ºè§†é¢‘æ¨¡å¼ä¸”æœ‰å›¾ç‰‡ä¸Šä¼ 
                    if (mode === 'video') {
                        const imageFile = document.getElementById('reference_image').files[0];
                        
                        if (imageFile) {
                            // å°†å›¾ç‰‡è½¬æ¢ä¸ºbase64
                            const base64Image = await fileToBase64(imageFile);
                            
                            messages.push({
                                role: 'user',
                                content: [
                                    { type: 'text', text: userInput },
                                    { 
                                        type: 'image_url',
                                        image_url: {
                                            url: `data:image/jpeg;base64,${base64Image}`
                                        }
                                    }
                                ]
                            });
                        } else {
                            messages.push({ role: 'user', content: userInput });
                        }
                    } else {
                        // å›¾ç‰‡æ¨¡å¼åªå‘é€æ–‡æœ¬
                        messages.push({ role: 'user', content: userInput });
                    }
                    
                    const response = await fetch(apiBase + '/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'ep-20250814140052-84jt2', // æ›´æ¢ä¸ºDoubaoæ¨¡å‹
                            messages: messages,
                            temperature: 0.7,
                            max_tokens: 1200
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const prompt = data.choices[0].message.content;
                    
                    showResult(prompt, mode);
                } catch (error) {
                    alert('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
                } finally {
                    // éšè—åŠ è½½åŠ¨ç”»ï¼Œæ¢å¤æŒ‰é’®
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'ğŸš€ ç”Ÿæˆ Prompt';
                    loadingContainer.style.display = 'none';
                }
            }
            
            // æ˜¾ç¤ºç»“æœ
            // ä¿®æ”¹showResultå‡½æ•°
            function showResult(prompt, mode) {
                const resultContainer = document.getElementById('resultContainer');
                const resultTitle = document.getElementById('resultTitle');
                const resultText = document.getElementById('resultText');
                
                if (mode === 'image') {
                    resultTitle.textContent = 'ğŸ“¸ å›¾ç‰‡ Promptï¼š';
                    // ç›´æ¥æ˜¾ç¤ºpromptï¼Œä¸æ·»åŠ æ ‡é¢˜å’Œè´Ÿé¢æç¤ºè¯
                    resultText.textContent = prompt;
                } else {
                    resultTitle.textContent = 'ğŸ¬ è§†é¢‘ Promptï¼š';
                    resultText.textContent = prompt;
                }
                
                resultContainer.classList.add('show');
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
